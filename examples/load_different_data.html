<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Minimal User Interface</title>
    <link rel="stylesheet" href="https://niivue.github.io/niivue/features/niivue.css" />
  </head>
  <body>
    <header>
      <div class="dropdown">
        <button class="dropbtn">
          File
          <i class="fa fa-caret-down"></i>
        </button>
        <div class="dropdown-content">
          <a class="viewBtn" id="SaveBitmap">Screen Shot</a>
          <a class="viewBtn" id="ShowHeader">Show Header</a>
          <a class="linker" href="https://github.com/niivue/niivue">About</a>
        </div>
      </div>
      <div class="dropdown">
        <button class="dropbtn" data-toggle="dropdown">
          View
          <i class="fa fa-caret-down"></i>
        </button>
        <div class="dropdown-content">
          <a href="#" class="viewBtn" id="|Axial">Axial</a>
          <a class="viewBtn" id="|Sagittal">Sagittal</a>
          <a class="viewBtn" id="|Coronal">Coronal</a>
          <a class="viewBtn" id="|Render">Render</a>
          <a class="viewBtn" id="|MultiPlanar">A+C+S</a>
          <a class="viewBtn dropdown-item-checked" id="|MultiPlanarRender"
            >A+C+S+R</a
          >
          <a class="viewBtn divider dropdown-item-checked" id="Colorbar"
            >Colorbar</a
          >
          <a class="viewBtn" id="Radiological">Radiological</a>
          <a class="viewBtn dropdown-item-checked" id="Crosshair"
            >Render Crosshair</a
          >
          <a class="viewBtn" id="ClipPlane">Render Clip Plane</a>
        </div>
      </div>
      <div class="dropdown">
        <button class="dropbtn">
          Color
          <i class="fa fa-caret-down"></i>
        </button>
        <div class="dropdown-content">
          <a class="viewBtn dropdown-item-checked" id="!Gray">Gray</a>
          <a class="viewBtn" id="!Plasma">Plasma</a>
          <a class="viewBtn" id="!Viridis">Viridis</a>
          <a class="viewBtn" id="!Inferno">Inferno</a>
		  <a class="viewBtn" id="!Random">Random</a>
          <a class="viewBtn divider dropdown-item-checked" id="BackColor">
		  Dark Background
		  </a>
        </div>
      </div>
      <div class="dropdown">
        <button class="dropbtn">
          Script
          <i class="fa fa-caret-down"></i>
        </button>
        <div class="dropdown-content">
          <a class="viewBtn dropdown-item-checked" id="_Brain">Brain</a> 
          <a class="viewBtn" id="_Lausanne1">Lausanne1</a>
          <a class="viewBtn" id="_Lausanne2">Lausanne2</a>
          <a class="viewBtn" id="_Lausanne5">Lausanne5</a>
          <a class="viewBtn" id="_Spconn">connectome</a>
		  <a class="viewBtn" id="_SEEGconn">SEEG</a>
        </div>
      </div>
    </header>
    <main id="container">
      <canvas id="gl1"></canvas>
    </main>
    <footer id="intensity">&nbsp;</footer>
  </body>
</html>
<script type="module" async>
  import * as niivue from "https://cdn.jsdelivr.net/npm/@niivue/niivue@0.46.0/dist/index.js";
  
  const isTouchDevice =
    "ontouchstart" in window ||
    navigator.maxTouchPoints > 0 ||
    navigator.msMaxTouchPoints > 0;
  function handleIntensityChange(data) {
    document.getElementById("intensity").innerHTML =
      "&nbsp;&nbsp;" + data.string;
  }
  var nv1 = new niivue.Niivue({
    logging: true,
    dragAndDropEnabled: false,
    // backColor: [0, 0, 0, 1],
    show3Dcrosshair: true,
    onLocationChange: handleIntensityChange,
  });
  nv1.opts.isColorbar = true;
  nv1.setRadiologicalConvention(false);
  nv1.attachTo("gl1");
  nv1.setClipPlane([0.3, 270, 0]);
  nv1.setRenderAzimuthElevation(120, 10);
  nv1.setSliceType(nv1.sliceTypeMultiplanar);
  nv1.setSliceMM(true);
  nv1.opts.isOrientCube = true;
  nv1.opts.multiplanarShowRender = niivue.SHOW_RENDER.ALWAYS;
  nv1.graph.autoSizeMultiplanar = true;
  nv1.graph.opacity = 1.0;
  var volumeList1 = [{ url: "https://roehrin.github.io/test/src/sub-template_desc-brain_T1w.nii.gz"}];
  await nv1.loadVolumes(volumeList1);
  function toggleGroup(id) {
    let buttons = document.getElementsByClassName("viewBtn");
    let char0 = id.charAt(0);
    for (let i = 0; i < buttons.length; i++) {
      if (buttons[i].id.charAt(0) !== char0) continue;
      buttons[i].classList.remove("dropdown-item-checked");
      if (buttons[i].id === id)
        buttons[i].classList.add("dropdown-item-checked");
    }
  } // toggleGroup()
  async function onButtonClick(event) {
    if (isTouchDevice) {
      console.log("Touch device: click menu to close menu");
      /*var el = this.parentNode
        el.style.display = "none"
        setTimeout(function() { //close menu
          //el.style.removeProperty("display")
          //el.style.display = "block"
        }, 500)*/
    }
    if (event.target.id === "SaveBitmap") {
      nv1.saveScene("ScreenShot.png");
      return;
    }
    if (event.target.id === "ShowHeader") {
      alert(nv1.volumes[0].hdr.toFormattedString());
      return;
    }
    if (event.target.id === "Colorbar") {
      nv1.opts.isColorbar = !nv1.opts.isColorbar;
      event.srcElement.classList.toggle("dropdown-item-checked");
      nv1.drawScene();
      return;
    }
    if (event.target.id === "Radiological") {
      nv1.opts.isRadiologicalConvention = !nv1.opts.isRadiologicalConvention;
      event.srcElement.classList.toggle("dropdown-item-checked");
      nv1.drawScene();
      return;
    }
    if (event.target.id === "Crosshair") {
      nv1.opts.show3Dcrosshair = !nv1.opts.show3Dcrosshair;
      event.srcElement.classList.toggle("dropdown-item-checked");
      nv1.drawScene();
    }
    if (event.target.id === "ClipPlane") {
      if (nv1.scene.clipPlaneDepthAziElev[0] > 1)
        nv1.setClipPlane([0.3, 270, 0]);
      else nv1.setClipPlane([2, 270, 0]);
      nv1.drawScene();
      return;
    }
    if (event.target.id.charAt(0) === "!") {
      // set color scheme
      //nv1.volumes[0].colormap = cmaps[i];
      nv1.volumes[0].colormap = event.target.id.substr(1);
      nv1.updateGLVolume();
      toggleGroup(event.target.id);
      return;
    }
    if (event.target.id.charAt(0) === "|") {
      //sliceType
      if (event.target.id === "|Axial") nv1.setSliceType(nv1.sliceTypeAxial);
      if (event.target.id === "|Coronal")
        nv1.setSliceType(nv1.sliceTypeCoronal);
      if (event.target.id === "|Sagittal")
        nv1.setSliceType(nv1.sliceTypeSagittal);
      if (event.target.id === "|Render") nv1.setSliceType(nv1.sliceTypeRender);
      if (event.target.id === "|MultiPlanar") {
        nv1.opts.multiplanarShowRender = niivue.SHOW_RENDER.NEVER;
        nv1.setSliceType(nv1.sliceTypeMultiplanar);
      }
      if (event.target.id === "|MultiPlanarRender") {
        nv1.opts.multiplanarShowRender = niivue.SHOW_RENDER.ALWAYS;
        nv1.setSliceType(nv1.sliceTypeMultiplanar);
      }
      toggleGroup(event.target.id);
    } //sliceType
    if (event.target.id === "BackColor") {
      if (nv1.opts.backColor[0] < 0.5) nv1.opts.backColor = [1, 1, 1, 1];
      else nv1.opts.backColor = [0, 0, 0, 1];
      nv1.drawScene();
      event.srcElement.classList.toggle("dropdown-item-checked");
      return;
    }
	if (event.target.id === "_Spconn") {
	  nv1.meshes = []; //close open meshes
	  nv1.opts.showLegend = true;
	  nv1.opts.meshXRay = .3
      volumeList1[0].url = "https://roehrin.github.io/test/src/sub-template_desc-brain_T1w.nii.gz";
      await nv1.loadVolumes(volumeList1);
      nv1.loadMeshes([
        {url: "https://roehrin.github.io/test/src/graph_example_adjacency.jcon"}
      ]);
      toggleGroup(event.target.id);
    } else if (event.target.id === "_SEEGconn") {
	  nv1.meshes = []; //close open meshes
	  nv1.opts.showLegend = false;
	  nv1.opts.meshXRay = .3
      volumeList1[0].url = "https://roehrin.github.io/test/src/sub-template_desc-brain_T1w.nii.gz";
      await nv1.loadVolumes(volumeList1);
      nv1.loadMeshes([
        {url: "https://roehrin.github.io/test/src/seeg_mesh_test.jcon"}
      ]);
      toggleGroup(event.target.id);
    } else if (event.target.id === "_Brain") {
	  nv1.meshes = []; //close open meshes
	  nv1.opts.meshXRay = 0
      volumeList1[0].url = "https://roehrin.github.io/test/src/sub-template_desc-brain_T1w.nii.gz";
      nv1.loadVolumes(volumeList1);
      toggleGroup(event.target.id);
      nv1.updateGLVolume();
    } else if (event.target.id === "_Lausanne1") {
	  nv1.meshes = []; //close open meshes
	  nv1.opts.meshXRay = 0
      volumeList1[0].url = "https://roehrin.github.io/test/src/sub-template_atlas-L2018_res-scale1_dseg.nii.gz";
      nv1.loadVolumes(volumeList1);
      toggleGroup(event.target.id);
      nv1.updateGLVolume();
    } else if (event.target.id === "_Lausanne2") {
	  nv1.meshes = []; //close open meshes
	  nv1.opts.meshXRay = 0
      volumeList1[0].url = "https://roehrin.github.io/test/src/sub-template_atlas-L2018_res-scale2_dseg.nii.gz";
      nv1.loadVolumes(volumeList1);
      toggleGroup(event.target.id);
      nv1.updateGLVolume();
    } else if (event.target.id === "_Lausanne5") {
	  nv1.meshes = []; //close open meshes
	  nv1.opts.meshXRay = 0
      volumeList1[0].url = "https://roehrin.github.io/test/src/sub-template_atlas-L2018_res-scale5_dseg.nii.gz";
      nv1.loadVolumes(volumeList1);
      toggleGroup(event.target.id);
      nv1.updateGLVolume();
    }//example image
  } // onButtonClick()
  var buttons = document.getElementsByClassName("viewBtn");
  for (let i = 0; i < buttons.length; i++)
    buttons[i].addEventListener("click", onButtonClick, false);
</script>
